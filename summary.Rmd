---
title: "summary"
author: "Max"
date: "2024-04-13"
output: html_document
---


## Goal: How can We Quantify the quality of a city: 
## Initial dataframe imported/edited (widened)
```{r}

```


Initial dataframe has thousands of rows which are the metrics, and each row corresponds to a different group. 
Unsupervised setting, this is a domain understanding project. There is no prediction, we are mostly trying to create our own grade/grouping of major US cities. This is subjective though, there is no specific rating, so we are going to attempt to do this ourselves. 

## Initial dataframe edited: dropped variables

```{r}
cities_clean
```
```{r}
numeric_data ## numeric data no id vars
```


### initial data analysis
CHecked correlations, histograms of data. 
Found high correlations, makes sense for hi-d with low n. 
Tried 2 methods of dimension reduction:
  - Feature selection through domain selection
  - PCA

```{r}
##pca_result is pca
pca_df = pca_result$x
feat_sel_df = new_df
```

## Clustering

```{r}
## From feature selection
df_clusters  ## City clusters
df_clusters %>% select(geo_label_city, Cluster)
categories ## variables
## From pca
cluster_labels$cities = rownames(cluster_labels)
```

## Analyzing differences
```{r}
diff = cluster_labels %>% left_join(
  df_clusters %>% select(geo_label_city, Cluster), by = join_by("cities" == "geo_label_city")
)
```


```{r}
View(categories)
```



## Prediction of quality of cities:
  1) groupings: nonlinear:

  2) indexes--> PC or through 
  

## Using the predictions of the quality of cities:
  1) Compare to one we got off internet
  2) See how this impacts movement to and from a city


## Compare rankings to clusters

```{r}
rankings = final %>% select(ends_with("Rank"), ends_with("Score"), geo_label_city, Cluster)
```


```{r}
df_averages <- rankings %>%
  group_by(Cluster) %>%
  summarise(
    avg_Rank = mean(`Overall Rank`, na.rm = TRUE),
    avg_wellbeing = mean(`Emotional and Physical Well-being Rank`, na.rm = TRUE),
    avg_finance = mean(`Income and Employment Rank`, na.rm = TRUE),
    avg_env= mean(`Community and Environment Rank`, na.rm = TRUE),
    avg_Score = mean(`Total Score`, na.rm = TRUE)
  )

# View the results
print(df_averages)
#correlate(df_averages %>% select(!Cluster))
```
```{r}
df_long <- rankings %>%
  pivot_longer(cols = ends_with("Rank"), names_to = "ranking", values_to = "value")
```

```{r}
ggplot(df_long, aes(x = Cluster, y = value, fill = ranking)) +
  geom_boxplot() +
  theme_bw() +
  labs(title = "Ranking Distribution by Cluster", x = "Cluster", y = "Ranking")
```

```{r}
ggplot(df_long, aes(x = Cluster, y = value, fill = ranking)) +
  geom_violin() +
  theme_bw() +
  labs(title = "Ranking Distribution by Cluster", x = "Cluster", y = "Ranking")
```

```{r}
df_summary <- df_long %>%
  group_by(Cluster, ranking) %>%
  summarize(mean_value = mean(value, na.rm = TRUE))

ggplot(df_summary, aes(x = Cluster, y = mean_value, fill = ranking)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_bw() +
  labs(title = "Average Ranking by Cluster", x = "Cluster", y = "Average Ranking")
```

```{r}
ggplot(df_long, aes(x = Cluster, y = value, color = ranking)) +
  geom_point(position = position_jitterdodge()) +
  theme_bw() +
  labs(title = "Rankings by Cluster", x = "Cluster", y = "Ranking")
```